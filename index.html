<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„ AI åŠ©æ‰‹</title>
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, sans-serif; background-color: #f0f2f5; height: 100vh; display: flex; flex-direction: column; }
        header { background: white; padding: 15px; text-align: center; font-weight: bold; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        #chat-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .message { max-width: 80%; padding: 12px 16px; border-radius: 12px; font-size: 15px; line-height: 1.5; word-wrap: break-word; }
        .user-message { align-self: flex-end; background-color: #0084ff; color: white; border-bottom-right-radius: 2px; }
        .ai-message { align-self: flex-start; background-color: white; color: #333; box-shadow: 0 1px 2px rgba(0,0,0,0.1); border-bottom-left-radius: 2px; }
        .input-area { background: white; padding: 15px; display: flex; gap: 10px; border-top: 1px solid #ddd; }
        input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 20px; outline: none; }
        button { padding: 10px 20px; background: #0084ff; color: white; border: none; border-radius: 20px; font-weight: bold; }
        .error-msg { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <header>ğŸ”® æ³°ä½›ä»ªå¼ AI åŠ©æ‰‹</header>
    <div id="chat-container">
        <div class="message ai-message">ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ AI åŠ©æ‰‹ã€‚</div>
    </div>
    <div class="input-area">
        <input type="text" id="userInput" placeholder="è¾“å…¥ä½ çš„é—®é¢˜...">
        <button onclick="sendMessage()">å‘é€</button>
    </div>

    <script>
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('userInput');

        function appendMessage(text, sender, isError = false) {
            const div = document.createElement('div');
            div.classList.add('message', sender === 'user' ? 'user-message' : 'ai-message');
            if (isError) div.classList.add('error-msg');
            div.innerText = text;
            chatContainer.appendChild(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        async function sendMessage() {
            const text = userInput.value.trim();
            if (!text) return;
            
            appendMessage(text, 'user');
            userInput.value = '';

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: text })
                });

                // â˜… è¿™é‡Œæ˜¯å…³é”®ï¼å°è¯•è¯»å–åç«¯å‘å›æ¥çš„è¯¦ç»†é”™è¯¯
                let data;
                try {
                    data = await response.json();
                } catch (jsonError) {
                    // å¦‚æœè¿ JSON éƒ½ä¸æ˜¯ï¼Œè¯´æ˜æœåŠ¡å™¨å½»åº•å´©äº†ï¼Œæ‰“å°çŠ¶æ€ç 
                    throw new Error(`æœåŠ¡å™¨çŠ¶æ€: ${response.status} (${response.statusText})`);
                }

                if (data.error) {
                    appendMessage("å‡ºé”™äº†: " + data.error, 'ai', true);
                } else {
                    appendMessage(data.text, 'ai');
                }
            } catch (e) {
                // æ˜¾ç¤ºå…·ä½“çš„ç½‘ç»œé”™è¯¯åŸå› 
                appendMessage("é€šä¿¡å¤±è´¥: " + e.message, 'ai', true);
            }
        }
    </script>
</body>
</html>
